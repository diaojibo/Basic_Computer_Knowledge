## SSRF漏洞
SSRF(Server-side Request Forge, 服务端请求伪造)。
由攻击者构造的攻击链接传给服务端执行造成的漏洞，一般用来在外网探测或攻击内网服务。

很多web应用都提供了从其他的服务器上获取数据的功能。使用用户指定的URL，web应用可以获取图片，下载文件，读取文件内容等。这个功能如果被恶意使用，可以利用存在缺陷的web应用作为代理攻击远程和本地的服务器。这种形式的攻击称为服务端请求伪造攻击（Server-side Request Forgery）

也就是：利用一个可以发起网络请求的服务，当作跳板来攻击其他服务。

**漏洞形成的原因大多是因为服务端提供了从其他服务器应用获取数据的功能且没有对目标地址作过滤和限制。**

### SSRF目的
 - 探测内网信息
 - 攻击内网或本地其他服务
 - 穿透防火墙

### 常见被攻击场景
 - 在线识图，在线文档翻译，分享，订阅等，这些有的都会发起网络请求。
 - 根据远程URL上传，静态资源图片等，这些会请求远程服务器的资源。
 - 数据库的比如mongodb的copyDatabase函数
 - 邮件系统就是接收邮件服务器地址这些地方。
 - 文件就找ImageMagick，xml这些。
 - 从URL关键字中寻找，比如：source,share,link,src,imageurl,target等。

### 防护手段
根据腾讯安全规范：

 - 提取访问目标的hostname，进行DNS解析，判断IP是否处于内网。内网IP地址见3.4.1 内网IP网段与掩码；陷阱！需要防范短链接指向内网，或者302跳转到内网的情况。因此需设置循环次数。在循环次数内，每次跳转跟进都要对目标URL提取主机名解析IP，判断IP是否在内网，禁止对内网访问。

 - 若业务场景需访问目的地址可控，则对访问地址进行限制

 - 使用squid 搭建外网代理，设置ACL 禁止目的地址为公司内网网段的访问。所有出口外网的请求都经squid代理，可以完整地规避代码防范不周导致的SSRF漏洞。
