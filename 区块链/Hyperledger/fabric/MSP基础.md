# MSP基础
Fabric的架构中，有MSP这样一个逻辑结构，这个结构主要承担权限管理的作用。

![](image/fabric6.png)

上图是Fabric的大致结构，可以看到权限管理那一部分服务是由MSP来提供的。


![](image/fabric5.png)

MSP是**Membership Service Provider**的缩写，直译为成员关系服务提供者。

有几个相关的术语，必须要先了解清楚。

### CA
CA是PKI系统中通信**双方信任的实体**，被称为**可信第三方（Trusted Third Party，简称TTP）**。作为可信第三方的行为具有非否认性。

CA通过证书证实他人的公钥信息，证书上有CA的签名。用户如果因为信任证书而导致了损失，证书可以作为有效的证据用于追究CA的法律责任。正是因为CA愿意给出承担责任的承诺，所以也被称为可信第三方。

### certificate 证书
证书（certificate）是Fabric中权限管理的基础。目前采用了基于ECDSA算法的非对称加密算法来生成公钥和私钥，证书格式则采用了X.509的标准规范。

所谓的X509规范标准，其实就是一种非常通用的证书格式。一份X.509证书是一些标准字段的集合，这些字段包含有关用户或设备及其相应公钥的信息。X.509标准定义了证书中应该包含哪些信息，并描述了这些信息是如何编码的(即数据格式)

根据百度百科，证书里的内容大致如下图

![](image/fabric7.png)

总之就是，Fabric中采用单独的Fabric CA项目来管理证书的生成。每一个实体、组织都可以拥有自己的身份证书，并且证书也遵循了组织结构，方便基于组织实现灵活的权限管理。

### 成员&组织
成员Member是拥有网络唯一根证书的合法独立实体，在fabric网络里就相当于提供服务的节点s(可能还不止一个)。一个组织中的成员可以根据网络中流量的要求，提供不同数量的节点服务来满足网络中的访问量。

组织（organization）代表**一组拥有共同信任的根证书**（可以为根CA证书或中间CA证书）的成员。简而言之就是一组来源于同一个组织的节点。

![](image/fabric8.png)

如上图所示，三家银行一共三个组织，两两加入到同一个通道中彼此进行相关数据交互，而无需担心被其他人看到。

### Consortium 联盟
联盟由若干组织构成的集合，是联盟链场景所独有的结构形式。联盟一般用于多个组织相互合作的场景，例如某联盟中指定需要所有参与方同时对交易背书，才允许在网络中进行执行。


**联盟中的组织成员会使用同一个排序服务**，并且遵循相同的通道创建策略（Channel-CreationPolicy）。

### MSP成员关系服务提供者
成员服务提供者（MSP）是一个提供抽象化成员操作框架的组件。

MSP将颁发与校验证书，以及用户认证背后的所有密码学机制与协议都抽象了出来。

为了处理网络成员身份和身份，成员服务提供者(MSP)管理用户id，并对网络中的所有参与者进行身份验证。一个Fabric区块链网络可以由一个或多个MSPs控制。这提供了成员操作的模块化，以及跨不同成员标准和体系结构的互操作性。

对于每个MSP实例，MSP标识符都必须独一无二

### 成员服务Member Service
成员是最基本的元素，它对应的是我们Fabric网络中的Peer节点或者Order节点或者Fabric-CA。**MSP就是对这些成员进行身份的管理与验证的实现(抽象的)**。

总结为一句话，成员关系服务提供者，给成员提供成员服务。这种服务是基于PKI的MSP实现的

## 参考

[9-HyperLedger-Fabric原理-MSP详解（一）-MSP基础](https://zhuanlan.zhihu.com/p/35683522)

[超级账本HyperLedger：Fabric掰开揉碎，一文解惑](https://www.lijiaocn.com/%E9%A1%B9%E7%9B%AE/2018/06/25/hyperledger-fabric-main-point.html)