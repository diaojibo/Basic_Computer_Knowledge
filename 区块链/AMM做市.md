## AMM做市

defi体系下的流动性挖矿，就是我们把钱存到资金池中做时，提供流动性，从而获取代币取得收益。具体收益模型可以从网上了解



### XYZ模型

这里特地提一下XYZ模型

 AMM 机制是将所有人的资产汇集到流动池中，并根据一种名为**“恒定乘积做市商模型”**的算法进行做市商。**所谓的“恒定乘积”其实可以看成一个反比例函数“XY=Z”，无论 X 和 Y 怎么改变，Z 始终是一个定值。放到交易中是指某次交易前后流动池里的两种代币数量的乘积是恒定的，即买前乘积 = 买后乘积。**

举个例子：我在 Uniswap 中新建一个 ETH 与 X 代币的流动池（免费创建，无需费用），创建时 ETH 和 X 的数量分别为 10 和 100，这个时候 X 的价格为 0.1ETH，两者数量的乘积为 1000。创建完成之后，用户就可以在 Uniswap 上进行 ETH 与 X 的兑换了。假设有人用 1 个 ETH 来买 X，这个时候 1Eth 进入流动池，ETH 的数量变为 11，那么要保持两者乘积不变，X 的数量就要减少，这个减少的 X 的数量即为 1 个 ETH 能买到的 X 数量。根据恒定乘积可得，10*100=（10+1）*（100-X’），计算的 X’=9.09，即 1 个 ETH 可以买到 9.09 个 X，相对于原来 1ETH=10X 的价格来说，滑点（价格误差）为（10-9.09）/10*100%=9.09%。将 1 个 ETH 改成 5 个，同样可以算出 5 个 ETH 可以买到 33.33 个 X，1 个 ETH 只能够买到 6.67 个 X，滑点为 33.33%。从上述例子可以看出，“恒定乘积”算法其实原理一点都不复杂，并且有如下特点：

**1、根据交易情况反映价格。**

当有人用 A 代币兑换 B 代币（即买入 B）时，B 的价格就会上涨，反过来（卖出 B）则 B 价格下跌，符合一般交易价格规律。(上例子1个ETH可以兑换的X变少了)

**2、流动性保持。**

无论流动池的资金规模如何，该算法均能提供流动性。

**3、不适合大额的交易兑换。**

我们发现在进行大额交易兑换的时候，价格变化很大，且不是线性的。当然，这个大额是相对于流动池的规模来判别的。

**所谓的“恒定乘积”是指在某次交易前后，乘积不变，也即是说流通池中的两种代币乘积并非是永远一成不变的。**那什么时候乘积会改变？对价格有没有影响呢？在 Uniswap 的 AMM 机制中，用户也可以往流动池中添加资金来帮助降低交易的滑点。但是如果随意添加代币到流动池中，代币的数量比例会改变，价格会产生较大的波动。**为了保持当前的两种代币价格兑换比例不会被改变，用户需要按当前比例数量的两种代币同时注入流动池中。这样一来，乘积会被扩大，但是两种代币的兑换价格并未改变。**值得一提的是，Uniswap 并没有发行自己的平台代币，为了激励用户往流动池中注入资金，资金池中的用户会按照资金比例平分该交易对的交易总额的 0.3% 的代币奖励

### 再讲无常损失

博玉要给一个比例 50/50 的 ETH/USDT 池子里提供流动性次产，我是池子的唯一一个流动性提供者，并且在里面翻了 10 个 ETH 和 100 个 USDT。

博玉进入池子的时候，一个 ETH 的价值在 100 刀 , 这么说博玉提供了：

- 10 个 ETH, 价值 1000 刀
- 1000 个 USDT, 价值 1000 刀
- 总价值（开始）：2000 刀

应市场需求，中心化交易所上的 ETH 价格涨到了 200 刀一个 ETH, 所以搬砖工会来 AMM 买入 ETH, 直到 AMM 中的 ETH 价格达到 200 刀一个 ETH。

按照 x * y = k 的算法公式，搬砖工搬完了的时候，博玉的池子里已经不是之前的代币比例，而是：

- 7.071 个 ETH, 价值 1414.21 刀
- 1414.21 个 USDT，价值 1414.21 刀
- 总价值（流动性）：2828.42 刀

虽然说博玉的 ETH 涨价之后的池子资产总价值，从一开始的 2000 刀涨到了 2828.42 刀，赚了，但是如果没有给池子提供资产的话，会有：

- 10 个 ETH， 价值 2000 刀
- 1000 个 USDT, 价值 1000 刀
- 总价值（拿着）：3000 刀

不考虑手续费和挖到的平台币因素，博玉如果没有给 AMM 的池子提供流动性和就拿着那原本的 10 个 ETH 和 1000 个 USDT，那么博玉现在的资产价值会更高，这么说博玉因为给 AMM 提供了流动性，少赚了 3000 – 2828.42 = 171.57 刀！这少赚的 171.57 刀就是这篇文章中的**无常损失**！

上面讲的案列，读起来的损失不是很大，那是因为池子里有一个稳定币和非稳定币的价格是涨的！**如果 AMM 池子里面的 2 个币种都不是稳定币的话，那么无常损失的余额将更高**

