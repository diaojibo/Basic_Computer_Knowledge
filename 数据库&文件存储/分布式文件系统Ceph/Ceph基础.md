## Ceph基础
什么是Ceph呢？中文定义可能比较绕口，看看英文定义：

```
Ceph (pronounced /ˈsɛf/ or /ˈkɛf/) is a free-software storage platform, implements object storage on a single distributed computer cluster, and provides interfaces for object-, block- and file-level storage.
```

Ceph是一个开源存储平台，在一个分布式集群中实现对象存储，并且提供了三种接口，对象存储接口，块存储接口，文件level存储接口。

zwlj: 总而言之，就是Ceph就是一个实现了"对象存储"的存储平台。并且提供三种接口来实现存储。

对于这几个概念，查阅了一些资料，有这样的一些说法。

### 对象存储
对象存储的概念并没有一个准确的定义，可以简单的认为它是 **分布式的key/value存储**.

之所以出现了对象存储这种东西，是为了克服块存储与文件存储各自的缺点， 发扬它俩各自的优点。简单来说块存储读写快，不利于共享，文件存储读写慢， 利于共享。

一个文件包含了了属性（术语叫metadata，元数据， 例如该文件的大小、修改时间、存储路径等）以及内容（以下简称数据）。 以往像FAT32这种文件系统，是直接将一份文件的数据与metadata 一起存储的，存储过程先将文件按照文件系统的最小块大小来打散 （如4M的文件，假设文件系统要求一个块4K，那么就将文件打散成 为1000个小块），再写进硬盘里面，过程中没有区分数据/metadata 的。而每个块最后会告知你下一个要读取的块的地址，然后一直这样 顺序地按图索骥，最后完成整份文件的所有块的读取。

这种情况下读写速率很慢，因为就算你有100个机械手臂在读写， 但是由于你只有读取到第一个块，才能知道下一个块在哪里， 其实相当于只能有1个机械手臂在实际工作。

而对象存储则将元数据独立了出来，控制节点叫元数据服务器（服务器+对象存储管理软件）， 里面主要负责存储对象的属性（主要是对象的数据被打散存放到了那几台分布式服务器中的信息）， 而其他负责存储数据的分布式服务器叫做OSD，主要负责存储文件的数据部分。 当用户访问对象，会先访问元数据服务器，元数据服务器只负责反馈对象存储在哪些OSD， 假设反馈文件A存储在B、C、D三台OSD，那么用户就会再次直接访问3台OSD服务器去读取数据。 这时候由于是3台OSD同时对外传输数据，所以传输的速度就加快了。当OSD服务器数量越多， 这种读写速度的提升就越大，通过此种方式，实现了读写快的目的。

### 存储接口
有云公司存储工程师认为：

分布式存储的应用场景相对于其存储接口，现在流行分为三种:

 - 对象存储: 也就是通常意义的键值存储，其接口就是简单的GET、PUT、DEL和其他扩展，如七牛、又拍、Swift、S3
 - 块存储: 这种接口通常以QEMU Driver或者Kernel Module的方式存在，这种接口需要实现Linux的Block Device的接口或者QEMU提供的Block Driver接口，如Sheepdog，AWS的EBS，青云的云硬盘和阿里云的盘古系统，还有Ceph的RBD（RBD是Ceph面向块存储的接口）
 - 文件存储: 通常意义是支持POSIX接口，它跟传统的文件系统如Ext4是一个类型的，但区别在于分布式存储提供了并行化的能力，如Ceph的CephFS(CephFS是Ceph面向文件存储的接口)，但是有时候又会把GFS，HDFS这种非POSIX接口的类文件存储接口归入此类。


按照这三种接口和其应用场景，很容易了解这三种类型的IO特点，括号里代表了它在非分布式情况下的对应：

 - 对象存储（键值数据库）： 接口简单，一个对象我们可以看成一个文件，只能全写全读，通常以大文件为主，要求足够的IO带宽。
 - 块存储（硬盘）：它的IO特点与传统的硬盘是一致的，一个硬盘应该是能面向通用需求的，即能应付大文件读写，也能处理好小文件读写。但是硬盘的特点是容量大，热点明显。因此块存储主要可以应付热点问题。另外，块存储要求的延迟是最低的。
 - 文件存储（文件系统）：支持文件存储的接口的系统设计跟传统本地文件系统如Ext4这种的特点和难点是一致的，它比块存储具有更丰富的接口，需要考虑目录、文件属性等支持，实现一个支持并行化的文件存储应该是最困难的。但像HDFS、GFS这种自己定义标准的系统，可以通过根据实现来定义接口，会容易一点。



对于大多数文件系统来说，尤其是POSIX兼容的文件系统，提供open、close、read、write和lseek等接口。

而对象存储的接口是REST风格的，通常是基于HTTP协议的RESTful Web API，通过HTTP请求中的PUT和GET等操作进行文件的上传即写入和下载即读取，通过DELETE操作删除文件。