## strace+pstack分析程序性能

  若能直接找到影响程序运行时间的函数调用，再有针对地对相关函数进行代码分析和优化，那相比漫无目的地看代码，效率就高多了。

将strace和pstack工具结合起来使用，就可以达到以上目的。strace跟踪程序使用的底层系统调用，可输出系统调用被执行的时间点以及各个调用耗时；pstack工具对指定PID的进程输出函数调用栈  



分析时，我们当然要先找出进程的pid，通过ps，比如

![img](https://img-blog.csdn.net/20170912131538882)



然后用pstack就可以打出线程栈的所有信息

![img](https://img-blog.csdn.net/20170912131547704)



好比说，我们通过pstack调用栈，发现大多数的线程都卡在了pwrite这个函数上。那不正常啊，我们接下来就要通过strace函数来做进一步分析了。



```
strace -o output.txt -T -tt -e trace=all -p 171264
```

nws进程中的171264线程进行系统调用跟踪， 将输出的信息保存在output.txt中

![img](https://img-blog.csdn.net/20170912131815720)



后面尖括号括起来的就是执行时间，对于跑一段时间的程序来说，这种分析的方式很管用。