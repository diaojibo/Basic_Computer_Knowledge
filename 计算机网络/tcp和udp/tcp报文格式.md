### TCP报文格式

TCP报文格式如下图所示。

![](image/tcp3.jpg)

前面4个字节是源端口，目的端口不用说了。

#### 序号
占4字节，TCP是面向字节流的，这里记录的是本次报文发送的**第一个字节的序号**。

#### 确认号
占4字节，**期望收到的对方的下一个报文的第一个字节序号**。

#### 数据偏移
占4位，表明数据部分距离起始处有多远，实际上**就是指出这个分组TCP header的实际大小**

这里注意，是以4个字节为单位的。比如数据偏移是1111(十进制15)的话，15*4=60字节。可得头部为60字节。**同时我们也知道了TCP头部最大为60字节，除去常规的20字节，即选项(变长头部)长度最大为40字节。**

#### 保留
给以后用的，全置0.

#### 紧急URG
用来插队，即让这个分组可以在缓存中被优先读取。

跟紧急指针配合使用

#### ACK
ACK为1时，确认号才有效。

TCP规定建立连接后所有分组的ACK都要置1.

#### PSH
push，收到这个字段以后，将会“尽快”创建成一个报文段发出。对方也会“尽快”创建成一个报文段交付给进程。

解决的问题是，**不需要等缓存满了再向上交付**

#### RST
要求释放连接并重新再握手创建连接。

#### SYN
同步位，用来同步的时候用。

#### FIN
要求释放连接

#### 窗口字段
这里是告诉对方，自己的**接受窗口**大小，切勿弄错。

#### 校验和
顾名思义，用来差错检测。

#### 紧急指针
配合URG使用，指出紧急数据的字节数。

#### 选项
变长头部数据，根据数据偏移字段可知，最长可达40字节。

选项有几种数据可以指定，比如MSS，SACK(用于选择重传)等

这里说一说MSS

##### MSS(Maximum Segment size)最大报文段长度
顾名思义，就是整个报文，**除去头部的数据部分的长度**。

因为tcp报文大的话，会导致IP层分片，太小的话，头部又成了主要传输对象，传输效率低，所以指定一个合适的MSS很重要。

不指定的话，默认是**536字节**
