## C++共享内存

共享内存首先为一块实际物理内存，该块物理内存地址被影射到对应的不同进程地址空间中，如此不同的进程都可见共享内存中的所有数据。

从大型软件系统角度讲，共享内存的应用往往是进程通信的最好选择，尤其是需要处理大数据量的分布式实时系统。

在讲共享内存之前，还要先简单了解一下Linux的IPC标准，在操作系统笔记里也有提到，IPC就是进程间通信，有很多方法，但是这些方法其实都遵循不同的标准。

![](image/ipc0.png)

上面的图，是IPC标准的演进图。

 Linux系统中进程通信IPC基本从Unix系统继承而来。由于Unix系统最初发展产生分支，主要由当前AT&T贝尔实验室以及BSD两个机构分别实现两个版本的Unix系统。从IPC进程通信的角度来讲，AT&T版本的Unix主要发展形成**SystemV标准的IPC通信方式**，该方式仅仅限制于单台主机内部不同进程通信；而BSD机构版本的Unix则发展出**可以进行不同主机不同进程通信基于socket的进程通信方式**。

 为了摆脱不同版本的Unix差异性便于不同版本之间的可移植性，发展而来的新独立的Posix标准。Linux操作系统由于是基于Unix操作系统基础上发展而来的，除了支持Unix不同标准外，也很好的遵循了Posix标准。
 
 **从进程通信的角度看，Linux系统共支持三种不同标准通信方式。第一个是继承至AT&T机构Unix版本的SystemV的IPC方式，第二个支持BSD版本Unix基于socket不同主机通信方式，另外还支持Posix标准下的IPC通信方式。**


### 共享内存创建管理

 Linux系统中共享内存为一块实际分配的内存区域，该内存区域可以被映射到不同进程的地址空间，被不同的进程所共享。共享内存是进程IPC通信中最快的方式，读写只需将通信的数据直接从映射的共享内存执行单次拷贝即可。

 Linux中也提供了一组函数接口用于使用共享内存，而且使用共享共存的接口还与信号量的非常相似，而且比使用信号量的接口来得简单。它们声明在头文件 sys/shm.h中。


#### shmget函数
该函数用来创建共享内存，它的原型为：

``` c++
int shmget(key_t key, size_t size, int shmflg);
```

第一个参数，与信号量的semget函数一样，程序需要提供一个参数key（非0整数），它有效地为共享内存段命名，shmget函数成功时返回一个与key相关的共享内存标识符（非负整数），用于后续的共享内存函数。调用失败返回-1.







